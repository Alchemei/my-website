<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <title>English Master v8.0 Ultimate</title>
    
    <!-- Font: Manrope -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* --- AURORA THEME & CORE CSS --- */
        :root {
            --bg-dark: #020617;
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-surface: rgba(255, 255, 255, 0.05);
            --neon-blue: #3b82f6;
            --neon-purple: #8b5cf6;
            --neon-green: #10b981;
            --neon-orange: #f59e0b;
            --neon-red: #ef4444;
            --text-main: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.6);
            --radius-xl: 32px;
            --radius-lg: 20px;
            --nav-height: 80px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        
        body {
            font-family: 'Manrope', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0; padding: 0;
            height: 100dvh;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* Arka Plan Efektleri */
        .aurora-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 50% -20%, #1e1b4b, #000000);
            overflow: hidden;
        }
        .orb {
            position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.5;
            animation: float 15s infinite ease-in-out;
        }
        .orb-1 { width: 350px; height: 350px; background: var(--neon-purple); top: -10%; left: -10%; }
        .orb-2 { width: 300px; height: 300px; background: var(--neon-blue); bottom: 10%; right: -10%; animation-delay: -5s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(20px, 40px); } }

        /* Header & HUD */
        header { padding: 20px; z-index: 10; flex-shrink: 0; display: flex; flex-direction: column; gap: 15px; }
        .hud-top { display: flex; justify-content: space-between; align-items: center; }
        .hud-badge {
            background: rgba(0,0,0,0.6); border: 1px solid var(--glass-border);
            padding: 8px 16px; border-radius: 50px; font-size: 0.9rem; font-weight: 700;
            display: flex; align-items: center; gap: 8px; backdrop-filter: blur(12px);
        }
        .streak-badge { color: var(--neon-orange); box-shadow: 0 0 20px rgba(245,158,11,0.2); }
        .currency-badge { color: var(--neon-green); box-shadow: 0 0 20px rgba(16,185,129,0.2); }
        
        /* XP Bar */
        .xp-track { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        .xp-fill { height: 100%; background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple)); width: 0%; transition: width 0.6s ease; box-shadow: 0 0 15px var(--neon-blue); }

        /* Main Scroll Area */
        main { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 0 20px 120px 20px; }
        
        /* Components */
        .glass-panel {
            background: var(--glass-surface); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: var(--radius-lg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); padding: 20px; margin-bottom: 20px;
        }
        .btn {
            border: none; cursor: pointer; font-family: inherit; font-weight: 700; transition: all 0.2s;
            display: inline-flex; align-items: center; justify-content: center; position: relative;
        }
        .btn:active { transform: scale(0.96); }

        /* --- FLASHCARD --- */
        .flashcard-container { perspective: 1200px; height: 400px; width: 100%; cursor: pointer; margin-top: 10px; }
        .flashcard { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .flashcard.flipped { transform: rotateY(180deg); }
        
        .card-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            border-radius: var(--radius-xl); background: rgba(20, 20, 25, 0.8);
            border: 1px solid var(--glass-border); display: flex; flex-direction: column;
            justify-content: center; align-items: center; padding: 30px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .card-back { transform: rotateY(180deg); background: linear-gradient(135deg, #1e1b4b, #312e81); border-color: var(--neon-blue); }

        .word-lg { font-size: 3rem; font-weight: 800; margin-bottom: 15px; background: linear-gradient(to bottom, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .word-context { font-size: 1.1rem; color: var(--text-muted); font-style: italic; margin-bottom: 40px; line-height: 1.5; }
        .word-meaning { font-size: 2.5rem; font-weight: 700; color: var(--neon-green); text-shadow: 0 0 30px rgba(16,185,129,0.4); }
        
        /* Card Actions */
        .card-actions { display: flex; gap: 20px; transition: opacity 0.2s; }
        .flashcard.flipped .card-actions { opacity: 0; pointer-events: none; }
        .action-btn { width: 50px; height: 50px; border-radius: 50%; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); font-size: 1.2rem; }

        .vote-container { display: flex; gap: 15px; margin-top: 30px; }
        .vote-btn { flex: 1; padding: 20px; border-radius: 24px; font-size: 1.1rem; color: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .vote-fail { background: linear-gradient(135deg, #ef4444, #b91c1c); }
        .vote-success { background: linear-gradient(135deg, #10b981, #059669); }

        /* --- SHOP & QUESTS --- */
        .shop-item { display: flex; justify-content: space-between; align-items: center; }
        .price-btn { background: rgba(245,158,11,0.15); padding: 8px 16px; border-radius: 50px; color: var(--neon-orange); border: 1px solid var(--neon-orange); }
        
        /* --- NAV DOCK --- */
        .nav-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; z-index: 100; }
        .nav-dock {
            background: rgba(15, 15, 20, 0.9); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.15); height: 70px; border-radius: 35px;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6); padding: 0 10px;
        }
        .nav-item { background: none; border: none; color: rgba(255,255,255,0.4); transition: all 0.3s; padding: 10px; }
        .nav-item.active { color: white; transform: translateY(-5px); text-shadow: 0 0 15px white; }
        .nav-item svg { width: 28px; height: 28px; }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        #toast {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            background: white; color: black; padding: 15px 30px; border-radius: 50px;
            font-weight: 800; z-index: 9999; transition: top 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        #toast.show { top: 30px; }
        
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-dark); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div class="aurora-bg"><div class="orb orb-1"></div><div class="orb orb-2"></div></div>
    <canvas id="confetti-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:150;"></canvas>
    <div id="toast">ƒ∞≈ülem Ba≈üarƒ±lƒ±</div>

    <!-- LOGIN -->
    <div id="login-screen">
        <div style="font-size:4rem; margin-bottom:20px;">‚ö°</div>
        <h1 style="margin-bottom:10px; font-size:2rem;">English Master</h1>
        <p style="color:var(--text-muted); margin-bottom:50px;">1000+ Kelime & Bulut E≈üleme</p>
        
        <button class="btn" onclick="loginWithGoogle()" style="background:white; color:black; width:80%; padding:18px; border-radius:20px; margin-bottom:15px; display:flex; gap:10px; font-size:1rem;">
            <svg width="20" height="20" viewBox="0 0 18 18" fill="none"><path d="M17.64 9.2c0-.637-.057-1.252-.164-1.841H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z" fill="currentColor"/><path d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.715H.957v2.332A8.997 8.997 0 0 0 9 18z" fill="#34A853"/><path d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/><path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.16 6.656 3.58 9 3.58z" fill="#EA4335"/></svg>
            Google ile Giri≈ü
        </button>
        <button class="btn" onclick="loginGuest()" style="background:rgba(255,255,255,0.1); color:white; width:80%; padding:15px; border-radius:20px; font-size:0.9rem;">Misafir Modu</button>
    </div>

    <header>
        <div class="hud-top">
            <div class="hud-badge streak-badge">üî• <span id="streak-display">0</span></div>
            <div class="hud-badge currency-badge">üü° <span id="coin-display">0</span></div>
        </div>
        <div class="xp-track"><div id="xp-bar" class="xp-fill"></div></div>
    </header>

    <main>
        <!-- TAB: LEARN -->
        <div id="tab-learn" class="fade-in">
            <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:20px;">
                <div><div style="color:var(--text-muted); font-size:0.9rem;">G√ºnl√ºk Hedef</div><h1 style="margin:0;">√ñƒüren</h1></div>
                <div style="color:var(--neon-blue); font-weight:700; font-family:monospace;" id="learn-progress-text">0 / 1000</div>
            </div>

            <div class="flashcard-container" onclick="flipCard()">
                <div class="flashcard" id="flashcard">
                    <div class="card-face card-front">
                        <div class="word-lg" id="fc-en">Loading...</div>
                        <div class="word-context" id="fc-ctx">...</div>
                        <div class="card-actions" onclick="event.stopPropagation()">
                            <button class="btn action-btn" onclick="playTTS()">üîä</button>
                            <button class="btn action-btn" onclick="toggleFav()">‚ù§Ô∏è</button>
                        </div>
                        <div style="margin-top:auto; color:var(--text-muted); font-size:0.8rem; text-transform:uppercase; letter-spacing:1px;">√áevirmek ƒ∞√ßin Dokun</div>
                    </div>
                    <div class="card-face card-back">
                        <div style="font-size:1rem; color:var(--text-muted); margin-bottom:10px;">T√ºrk√ße Anlamƒ±</div>
                        <div class="word-meaning" id="fc-tr">...</div>
                    </div>
                </div>
            </div>

            <div class="vote-container">
                <button class="btn vote-btn vote-fail" onclick="vote(false)">Tekrar</button>
                <button class="btn vote-btn vote-success" onclick="vote(true)">Biliyorum</button>
            </div>
        </div>

        <!-- TAB: SHOP -->
        <div id="tab-shop" class="hidden fade-in">
            <h1 style="margin-bottom:20px;">Maƒüaza</h1>
            
            <div class="glass-panel shop-item">
                <div style="display:flex; align-items:center; gap:15px;">
                    <div style="font-size:2rem;">‚ùÑÔ∏è</div>
                    <div><div style="font-weight:700; font-size:1.1rem;">Streak Freeze</div><div style="color:var(--text-muted); font-size:0.9rem;">Serini 1 g√ºn korur.</div></div>
                </div>
                <button class="btn price-btn" onclick="buyItem('freeze', 200)">200 üü°</button>
            </div>

            <div class="glass-panel shop-item">
                <div style="display:flex; align-items:center; gap:15px;">
                    <div style="font-size:2rem;">‚ö°</div>
                    <div><div style="font-weight:700; font-size:1.1rem;">Double XP</div><div style="color:var(--text-muted); font-size:0.9rem;">20 Kelime boyunca 2x XP.</div></div>
                </div>
                <button class="btn price-btn" onclick="buyItem('double', 350)">350 üü°</button>
            </div>
        </div>

        <!-- TAB: PROFILE -->
        <div id="tab-profile" class="hidden fade-in">
            <div style="text-align:center; margin:30px 0;">
                <div style="width:100px; height:100px; border-radius:50%; background:linear-gradient(45deg, var(--neon-blue), var(--neon-purple)); margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:2.5rem; box-shadow:0 0 30px rgba(59,130,246,0.5);">üë§</div>
                <h2 id="user-name">Misafir Kullanƒ±cƒ±</h2>
                <div style="color:var(--neon-green); font-size:0.9rem;" id="auth-status-text">√áevrimdƒ±≈üƒ± Mod</div>
            </div>

            <div class="glass-panel">
                <div style="display:flex; justify-content:space-between; border-bottom:1px solid var(--glass-border); padding-bottom:15px; margin-bottom:15px;">
                    <span>Toplam XP</span>
                    <span id="stat-xp" style="color:var(--neon-blue); font-weight:700;">0</span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span>√ñƒürenilen Kelime</span>
                    <span id="stat-words" style="color:var(--neon-green); font-weight:700;">0</span>
                </div>
            </div>

            <button class="btn w-full" style="padding:15px; background:rgba(255,255,255,0.1); border-radius:15px;" onclick="forceSync()">Bulutla E≈üitle üîÑ</button>
            <button class="btn w-full" style="margin-top:10px; padding:15px; color:var(--neon-red); border:1px solid var(--neon-red); background:transparent; border-radius:15px;" onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
        </div>
    </main>

    <div class="nav-container">
        <nav class="nav-dock">
            <button class="nav-item active" onclick="switchTab('learn', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg></button>
            <button class="nav-item" onclick="switchTab('shop', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path><path d="M3 6h18"></path><path d="M16 10a4 4 0 0 1-8 0"></path></svg></button>
            <button class="nav-item" onclick="switchTab('profile', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></button>
        </nav>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, onSnapshot, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // FIREBASE CONFIG (User Provided)
        const firebaseConfig = {
          apiKey: "AIzaSyDUN827ZeD2YhEYAkB5OeWkF6OIiF59bFI",
          authDomain: "learning-eng-cc8e5.firebaseapp.com",
          projectId: "learning-eng-cc8e5",
          storageBucket: "learning-eng-cc8e5.firebasestorage.app",
          messagingSenderId: "443233964962",
          appId: "1:443233964962:web:d7181e4bb4e2377c5898fb",
          measurementId: "G-K60HHNSBQ2"
        };

        // --- 1000+ WORDS DATABASE (COMPRESSED) ---
        // Format: EN|TR|CTX
        const rawData = "the|o, ≈üu|The book;of|-in, -ƒ±n|Piece of cake;and|ve|You and me;a|bir|A cat;to|-e, -a|Go to school;in|i√ßinde|In the box;is|dƒ±r, dir|He is tall;you|sen|You look good;that|≈üu|That car;it|o (cansƒ±z)|It is red;he|o (erkek)|He runs;was|idi|It was fun;for|i√ßin|For you;on|√ºzerinde|On table;are|dƒ±r (√ßoƒüul)|We are here;as|gibi|As fast as;with|ile|With me;his|onun (e)|His dog;they|onlar|They play;I|ben|I am;at|-de|At home;be|olmak|Be happy;this|bu|This one;have|sahip olmak|I have time;from|-den|From London;or|veya|Tea or coffee;one|bir|One day;had|vardƒ±|I had it;by|tarafƒ±ndan|By bus;word|kelime|New word;but|fakat|But why;not|deƒüil|Not me;what|ne|What is it;all|t√ºm√º|All people;were|idiler|They were;we|biz|We win;when|ne zaman|When go;your|senin|Your book;can|yapabilmek|I can swim;said|dedi|He said;there|orada|Over there;use|kullanmak|Use pen;an|bir|An apple;each|her biri|Each one;which|hangi|Which car;she|o (kadƒ±n)|She sings;do|yapmak|Do it;how|nasƒ±l|How are you;their|onlarƒ±n|Their home;if|eƒüer|If you can;will|ecek|I will go;up|yukarƒ±|Look up;other|diƒüer|Other hand;about|hakkƒ±nda|About us;out|dƒ±≈üarƒ±|Go out;many|pek √ßok|Many cars;then|sonra|And then;them|onlarƒ±|See them;these|bunlar|These books;so|bu y√ºzden|So happy;some|bazƒ±|Some water;her|onun (k)|Her bag;would|cekti|I would go;make|yapmak|Make food;like|sevmek|I like it;him|onu|Tell him;into|i√ßine|Into water;time|zaman|Time flies;has|sahip|He has;look|bakmak|Look at me;two|iki|Two cats;more|daha|More food;write|yazmak|Write name;go|gitmek|Go home;see|g√∂rmek|I see;number|numara|No 1;no|hayƒ±r|No thanks;way|yol|This way;could|yapabilirdi|Could go;people|insanlar|Many people;my|benim|My pen;than|-den|Bigger than;first|ilk|First day;water|su|Drink water;been|olmu≈ü|Have been;call|aramak|Call me;who|kim|Who is?;oil|yaƒü|Olive oil;its|onun|Its tail;now|≈üimdi|Do it now;find|bulmak|Find key;long|uzun|Long road;down|a≈üaƒüƒ±|Sit down;day|g√ºn|Sunny day;did|yaptƒ±|He did it;get|almak|Get gift;come|gelmek|Come here;made|yapƒ±lmƒ±≈ü|Made in TR;may|belki|May be;part|par√ßa|Car part;over|bitmi≈ü|Game over;new|yeni|New phone;sound|ses|Loud sound;take|almak|Take it;only|sadece|Only you;little|k√º√ß√ºk|Little boy;work|√ßalƒ±≈ümak|Work hard;know|bilmek|I know;place|yer|Nice place;year|yƒ±l|New year;live|ya≈üamak|Live here;me|bana|Give me;back|geri|Come back;give|vermek|Give money;most|en √ßok|Most fun;very|√ßok|Very good;after|sonra|After you;thing|≈üey|Good thing;our|bizim|Our car;just|sadece|Just now;name|isim|My name;good|iyi|Good job;sentence|c√ºmle|Short sentence;man|adam|Tall man;think|d√º≈ü√ºnmek|Think fast;say|s√∂ylemek|Say yes;great|harika|Great day;where|nerede|Where is;help|yardƒ±m|Help me;through|i√ßinden|Go through;much|√ßok|Too much;before|√∂nce|Before go;line|√ßizgi|Straight line;right|saƒü/doƒüru|Right hand;too|de/da|Me too;mean|demek|What mean;old|eski|Old car;any|herhangi|Any time;same|aynƒ±|Same size;tell|anlatmak|Tell story;boy|oƒülan|Good boy;follow|takip|Follow me;came|geldi|He came;want|istemek|Want food;show|g√∂stermek|Show me;also|ayrƒ±ca|Me also;around|etrafƒ±nda|Look around;farm|√ßiftlik|Big farm;three|√º√ß|Three dogs;small|k√º√ß√ºk|Small box;set|kurmak|Set clock;put|koymak|Put down;end|son|The end;does|yapar|He does;another|ba≈üka|Another one;well|iyi|Sleep well;large|geni≈ü|Large room;must|meli|Must go;big|b√ºy√ºk|Big house;even|bile|Even me;such|b√∂yle|Such fun;because|√ß√ºnk√º|Because why;turn|d√∂nmek|Turn left;here|burada|Sit here;why|neden|Why not;ask|sormak|Ask him;went|gitti|He went;men|adamlar|Two men;read|okumak|Read book;need|ihtiya√ß|Need help;land|arazi|My land;different|farklƒ±|Different color;home|ev|Go home;us|bize|Join us;move|hareket|Move it;try|denemek|Try hard;kind|nazik|Be kind;hand|el|My hand;picture|resim|Nice picture;again|tekrar|Try again;change|deƒüi≈üim|Big change;off|kapalƒ±|Turn off;play|oynamak|Play game;spell|hecelemek|Spell it;air|hava|Fresh air;away|uzak|Go away;animal|hayvan|Wild animal;house|ev|My house;point|nokta|Good point;page|sayfa|Page one;letter|mektup|Love letter;mother|anne|Hi mother;answer|cevap|Good answer;found|buldu|Found it;study|√ßalƒ±≈ümak|Study hard;still|hala|Still here;learn|√∂ƒürenmek|Learn English;should|meli|Should go;world|d√ºnya|Big world;high|y√ºksek|High jump;every|her|Every day;near|yakƒ±n|Near me;add|eklemek|Add sugar;food|yiyecek|Good food;between|arasƒ±nda|Between us;own|kendi|My own;below|a≈üaƒüƒ±da|Look below;country|√ºlke|My country;plant|bitki|Green plant;last|son|Last one;school|okul|At school;father|baba|My father;keep|tutmak|Keep it;tree|aƒüa√ß|Big tree;never|asla|Never say;city|≈üehir|Big city;earth|d√ºnya|Planet earth;eye|g√∂z|Blue eye;light|ƒ±≈üƒ±k|Sun light;thought|d√º≈ü√ºnce|Good thought;head|kafa|My head;under|altƒ±nda|Under bed;story|hikaye|Sad story;saw|g√∂rd√º|I saw it;left|sol|Turn left;don't|yapma|Don't go;few|az|Few people;while|iken|While eating;along|boyunca|Along road;might|olabilir|Might be;close|yakƒ±n/kapat|Close door;something|bir ≈üey|Something new;seem|g√∂r√ºnmek|Seem happy;next|sonraki|Next time;hard|zor|Hard work;open|a√ßƒ±k|Open door;example|√∂rnek|Good example;begin|ba≈ülamak|Begin now;life|hayat|My life;always|her zaman|Always happy;those|≈üunlar|Those cars;both|ikisi|Both hands;paper|kaƒüƒ±t|White paper;together|birlikte|Go together;got|aldƒ±|Got it;group|grup|Team group;often|sƒ±k sƒ±k|Often go;run|ko≈ümak|Run fast;important|√∂nemli|Important job;until|kadar|Until now;children|√ßocuklar|Happy children;side|yan|Side walk;feet|ayaklar|Two feet;car|araba|Red car;mile|mil|One mile;night|gece|Dark night;walk|y√ºr√ºmek|Walk slow;white|beyaz|White snow;sea|deniz|Blue sea;began|ba≈üladƒ±|It began;grow|b√ºy√ºmek|Trees grow;took|aldƒ±|Took it;river|nehir|Long river;four|d√∂rt|Four cats;carry|ta≈üƒ±mak|Carry bag;state|durum/eyalet|Good state;once|bir kez|Once more;book|kitap|Read book;hear|duymak|Hear sound;stop|durmak|Stop car;without|sƒ±z|Without you;second|saniye|One second;later|sonra|See later;miss|√∂zlemek|Miss you;idea|fikir|Great idea;enough|yeterli|Enough food;eat|yemek|Eat food;face|y√ºz|Wash face;watch|izlemek|Watch TV;far|uzak|Far away;Indian|Hintli|Indian food;real|ger√ßek|Real man;almost|neredeyse|Almost done;let|izin|Let go;above|yukarƒ±da|Look above;girl|kƒ±z|Nice girl;sometimes|bazen|Sometimes go;mountain|daƒü|High mountain;cut|kesmek|Cut paper;young|gen√ß|Young boy;talk|konu≈ümak|Talk loud;soon|yakƒ±nda|See soon;list|liste|Shop list;song|≈üarkƒ±|Sing song;being|olma|Human being;leave|ayrƒ±lmak|Leave me;family|aile|Big family;it's|o|It's ok";

        // --- APP STATE ---
        let app = { 
            xp: 0, coins: 500, streak: 1, learned: [], favs: [], 
            wordIndex: 0, lastLogin: new Date().toDateString(), 
            items: { freeze: false, doubleXP: 0 },
            isGuest: false
        };
        
        let words = [];
        let isFlipped = false;
        let db, auth, user, docRef;
        let firebaseApp;

        // --- INIT ---
        window.onload = async () => {
            parseWords();
            initFirebase();
            loadLocalData();
            render();
        };

        function parseWords() {
            words = rawData.split(';').map(item => {
                const [en, tr, ctx] = item.split('|');
                return { en, tr, ctx };
            });
        }

        function initFirebase() {
            try {
                firebaseApp = initializeApp(firebaseConfig);
                auth = getAuth(firebaseApp);
                db = getFirestore(firebaseApp);

                onAuthStateChanged(auth, (u) => {
                    if (u) {
                        user = u;
                        app.isGuest = false;
                        document.getElementById('login-screen').classList.add('hidden');
                        document.getElementById('user-name').innerText = u.displayName || u.email || 'Kullanƒ±cƒ±';
                        document.getElementById('auth-status-text').innerText = "Bulut E≈üitlendi ‚úÖ";
                        
                        // Sync Setup
                        const uid = user.uid;
                        docRef = doc(db, 'users', uid);
                        
                        onSnapshot(docRef, (snap) => {
                            if (snap.exists()) {
                                const cloudData = snap.data();
                                app = smartMerge(app, cloudData);
                                saveLocal(); // Save merged data locally
                                render();
                                toast("Veriler G√ºncellendi ‚òÅÔ∏è");
                            } else {
                                saveCloud(); // First time setup in cloud
                            }
                        }, (err) => {
                            // Silent error for unauthorized domain etc.
                            console.log("Offline/Local Mode Active");
                        });

                    } else {
                        document.getElementById('login-screen').classList.remove('hidden');
                    }
                });
            } catch (e) {
                console.log("Firebase not available, local mode only.");
            }
        }

        function smartMerge(local, cloud) {
            // Basit Mantƒ±k: Hangisi b√ºy√ºkse onu al (XP, Coin)
            // Listeleri birle≈ütir (Set)
            let merged = { ...local };
            
            if (cloud.xp > local.xp) merged.xp = cloud.xp;
            if (cloud.coins > local.coins) merged.coins = cloud.coins;
            
            // Merge Learned
            const combinedLearned = new Set([...local.learned, ...(cloud.learned || [])]);
            merged.learned = Array.from(combinedLearned);

            // Merge Favs
            const combinedFavs = new Set([...local.favs, ...(cloud.favs || [])]);
            merged.favs = Array.from(combinedFavs);
            
            // Items
            if(cloud.items) {
                if(cloud.items.doubleXP > local.items.doubleXP) merged.items.doubleXP = cloud.items.doubleXP;
                if(cloud.items.freeze) merged.items.freeze = true;
            }

            return merged;
        }

        function loadLocalData() {
            const saved = localStorage.getItem('engMaster_v8');
            if(saved) {
                try { app = { ...app, ...JSON.parse(saved) }; } catch(e) {}
            }
            loadCard();
        }

        function saveLocal() {
            localStorage.setItem('engMaster_v8', JSON.stringify(app));
        }

        function saveCloud() {
            if(user && docRef) {
                setDoc(docRef, app, { merge: true }).catch(() => {});
            }
        }

        function save() {
            saveLocal();
            saveCloud();
            render();
        }

        // --- CORE LOGIC ---
        window.flipCard = function() {
            const card = document.getElementById('flashcard');
            card.classList.toggle('flipped');
            isFlipped = !isFlipped;
        }

        window.vote = function(known) {
            const w = words[app.wordIndex];
            let gain = 10;
            
            if(known) {
                if(app.items.doubleXP > 0) { gain *= 2; app.items.doubleXP--; }
                app.xp += gain;
                app.coins += 5;
                if(!app.learned.includes(w.en)) app.learned.push(w.en);
                
                toast(`+${gain} XP Kazandƒ±n!`);
                confetti();
            }
            
            // Next word logic (Simple sequential for now, can be randomized)
            app.wordIndex = (app.wordIndex + 1) % words.length;
            
            save();
            setTimeout(() => {
                document.getElementById('flashcard').classList.remove('flipped');
                isFlipped = false;
                setTimeout(loadCard, 300);
            }, 200);
        }

        function loadCard() {
            if(!words.length) return;
            const w = words[app.wordIndex];
            document.getElementById('fc-en').innerText = w.en;
            document.getElementById('fc-ctx').innerText = w.ctx;
            document.getElementById('fc-tr').innerText = w.tr;
        }

        window.playTTS = function() {
            const t = new SpeechSynthesisUtterance(words[app.wordIndex].en);
            t.lang = 'en-US';
            speechSynthesis.speak(t);
        }

        window.toggleFav = function() {
            const w = words[app.wordIndex].en;
            if(app.favs.includes(w)) {
                app.favs = app.favs.filter(i => i !== w);
                toast("Favorilerden √áƒ±karƒ±ldƒ±");
            } else {
                app.favs.push(w);
                toast("Favorilere Eklendi ‚ù§Ô∏è");
            }
            save();
        }

        window.buyItem = function(id, cost) {
            if(app.coins >= cost) {
                if(id === 'freeze') {
                    if(app.items.freeze) { toast("Zaten Aktif!"); return; }
                    app.items.freeze = true;
                }
                if(id === 'double') {
                    app.items.doubleXP += 20;
                }
                app.coins -= cost;
                save();
                toast("Satƒ±n Alma Ba≈üarƒ±lƒ±! üéâ");
                confetti();
            } else {
                toast("Yetersiz Coin üòî");
            }
        }

        // --- UI & NAVIGATION ---
        window.switchTab = function(id, btn) {
            document.querySelectorAll('main > div').forEach(div => div.classList.add('hidden'));
            document.getElementById('tab-' + id).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            btn.classList.add('active');
            
            if(id === 'profile') renderProfile();
        }

        function render() {
            document.getElementById('streak-display').innerText = app.streak;
            document.getElementById('coin-display').innerText = app.coins;
            document.getElementById('learn-progress-text').innerText = `${app.learned.length} / ${words.length}`;
            
            // XP Bar
            const pct = (app.xp % 100);
            document.getElementById('xp-bar').style.width = pct + '%';
        }

        function renderProfile() {
            document.getElementById('stat-xp').innerText = app.xp;
            document.getElementById('stat-words').innerText = app.learned.length;
            
            const list = document.getElementById('favorites-list');
            list.innerHTML = '';
            if(app.favs.length === 0) list.innerHTML = '<div style="text-align:center; color:var(--text-muted);">Favori kelime yok.</div>';
            
            app.favs.forEach(f => {
                const w = words.find(i => i.en === f);
                if(w) {
                    list.innerHTML += `
                        <div class="glass-panel" style="padding:15px; display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>${w.en}</span>
                            <span style="color:var(--text-muted)">${w.tr}</span>
                        </div>
                    `;
                }
            });
        }

        // --- AUTH & UTILS ---
        window.loginWithGoogle = function() {
            const provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider).catch(err => {
                // Fallback for browsers blocking popup
                if (err.code === 'auth/popup-blocked' || err.code === 'auth/popup-closed-by-user') {
                     // Ignore or try redirect
                } else {
                    console.error(err); // Log but don't alert blocking errors
                }
            });
        }

        window.loginGuest = function() {
            app.isGuest = true;
            document.getElementById('login-screen').classList.add('hidden');
            loadLocalData();
        }

        window.logout = function() {
            if(user) signOut(auth);
            localStorage.removeItem('engMaster_v8');
            location.reload();
        }
        
        window.forceSync = function() {
             if(user && docRef) {
                 getDoc(docRef).then(snap => {
                     if(snap.exists()) {
                         app = smartMerge(app, snap.data());
                         save();
                         toast("Zorla E≈üitlendi ‚úÖ");
                     }
                 });
             } else {
                 toast("√ñnce giri≈ü yapmalƒ±sƒ±n.");
             }
        }

        window.resetData = function() {
            if(confirm("T√ºm ilerlemen silinecek?")) {
                localStorage.removeItem('engMaster_v8');
                if(user && docRef) setDoc(docRef, {xp:0, coins:500, learned:[]});
                location.reload();
            }
        }

        function toast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2500);
        }

        function confetti() {
            const c = document.getElementById('confetti-canvas');
            const ctx = c.getContext('2d');
            c.width = window.innerWidth; c.height = window.innerHeight;
            
            let particles = [];
            for(let i=0; i<50; i++) {
                particles.push({
                    x: c.width/2, y: c.height/2,
                    vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`, life: 100
                });
            }
            
            function anim() {
                ctx.clearRect(0,0,c.width,c.height);
                particles.forEach((p, i) => {
                    p.x += p.vx; p.y += p.vy; p.life--;
                    ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, 5, 5);
                    if(p.life <= 0) particles.splice(i, 1);
                });
                if(particles.length > 0) requestAnimationFrame(anim);
            }
            anim();
        }

    </script>
</body>
</html>