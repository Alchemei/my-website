<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" href="data:,"> 
    <title>English Master v7.1 (Fixed)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="aurora-bg"><div class="orb orb-1"></div><div class="orb orb-2"></div></div>
    <canvas id="confetti-canvas"></canvas>
    <div id="toast">ƒ∞≈ülem Ba≈üarƒ±lƒ±</div>
    
    <!-- Level Up Modal -->
    <div id="level-up-modal" class="modal-overlay hidden">
        <div class="modal-content glass-panel" style="text-align:center; padding:40px;">
            <div style="font-size:4rem; margin-bottom:10px;">üéâ</div>
            <h2 style="font-size:2.5rem; margin:0; color:var(--neon-purple); text-shadow:0 0 20px rgba(139,92,246,0.5);">SEVƒ∞YE ATLADIN!</h2>
            <div style="font-size:1.2rem; margin:20px 0; color:var(--text-muted);">Yeni Seviyen</div>
            <div id="new-level-display" style="font-size:5rem; font-weight:800; line-height:1; margin-bottom:30px; background:linear-gradient(to bottom, #fff, #a78bfa); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;">2</div>
            <button class="btn w-full" style="padding:15px; background:var(--neon-purple); color:white; border-radius:16px; font-size:1.1rem;" onclick="document.getElementById('level-up-modal').classList.add('hidden')">Harika!</button>
        </div>
    </div>
    <header>
        <div class="hud-top">
            <div class="hud-group">
                <div class="hud-badge level-badge" style="background: rgba(139, 92, 246, 0.2); color: #c4b5fd; border: 1px solid rgba(139, 92, 246, 0.3);">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>
                    <span id="level-display">1</span>
                </div>
                <div class="hud-badge streak-badge">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                    <span id="streak-display">0</span>
                </div>
                <div class="hud-badge currency-badge">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3h12l4 6-10 13L2 9l4-6z"></path></svg>
                    <span id="coin-display">0</span>
                </div>
            </div>
            <div id="sync-status" class="sync-status" title="Bulut Senkronizasyonu" onclick="window.retrySync()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"></path><path d="M12 12v9"></path><path d="m16 16-4-4-4 4"></path></svg>
            </div>
        </div>
        <div class="xp-track"><div id="xp-bar" class="xp-fill"></div></div>
    </header>
    <main>
        <div id="tab-learn" class="fade-in">
            <div class="page-header">
                <div><div class="page-title">Daily Session</div><h1 style="margin:0; font-size:1.8rem; font-weight:300;">Learn</h1></div>
                <div class="progress-text" id="learn-progress-text">0 / 1000</div>
            </div>
            <div class="flashcard-container" onclick="window.flipCard()">
                <div class="flashcard" id="flashcard">
                    <div class="card-face card-front">
                        <div class="word-lg" id="fc-en">...</div>
                        <div class="word-context" id="fc-ctx">...</div>
                        <div class="card-actions" onclick="event.stopPropagation()">
                            <button class="btn action-btn" onclick="window.playTTS()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 10.93a10 10 0 0 1 0 2.14"></path></svg></button>
                            <button class="btn action-btn" onclick="window.toggleFav()"><svg id="fav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg></button>
                        </div>
                        <div style="margin-top:auto; font-size:0.75rem; letter-spacing:2px; font-weight:600; text-transform:uppercase; opacity:0.6;">Tap to reveal</div>
                    </div>
                    <div class="card-face card-back">
                        <div class="word-meaning" id="fc-tr">...</div>
                    </div>
                </div>
            </div>
            <div class="vote-container">
                <button class="btn vote-btn vote-fail" onclick="window.vote(false)">Tekrar</button>
                <button class="btn vote-btn vote-success" onclick="window.vote(true)">Biliyorum</button>
            </div>
        </div>
        <div id="tab-quests" class="hidden fade-in">
            <div class="page-header"><h1 style="margin:0; font-size:1.8rem; font-weight:300;">Quests</h1><div class="page-title">Reset 00:00</div></div>
            <div id="quests-container"></div>
        </div>
        <div id="tab-quiz" class="hidden fade-in">
            <div id="quiz-play-area">
                <div class="page-header"><h1 style="margin:0; font-size:1.8rem; font-weight:300;">Quiz</h1><span id="quiz-counter" class="quiz-counter">1 / 20</span></div>
                <div class="glass-panel" style="text-align:center; padding:40px 20px;">
                    <div style="color:var(--text-muted); margin-bottom:15px; font-size:1.1rem;">Bu kelimenin anlamƒ±?</div>
                    <h1 id="q-word" style="color:white; margin:0 0 30px 0; font-size:2.5rem; font-weight:800; text-shadow:0 0 30px rgba(255,255,255,0.2);">...</h1>
                    <div id="q-options"></div>
                </div>
            </div>
            <div id="quiz-result-area" class="hidden fade-in">
                <div class="glass-panel" style="padding:40px; text-align:center;">
                    <h2 style="font-size:2rem; margin:0;">Tamamlandƒ±</h2>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin:30px 0;">
                        <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px;"><div style="font-size:0.8rem; color:var(--text-muted);">Doƒüru</div><div id="res-score" style="font-size:1.8rem; font-weight:700; color:var(--neon-green);">0</div></div>
                        <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px;"><div style="font-size:0.8rem; color:var(--text-muted);">XP</div><div id="res-xp" style="font-size:1.8rem; font-weight:700; color:var(--neon-blue);">0</div></div>
                    </div>
                    <button class="btn w-full" style="padding:18px; background:var(--neon-blue); color:white; border-radius:16px;" onclick="window.resetQuiz()">Tekrar Ba≈üla</button>
                </div>
            </div>
        </div>
        <div id="tab-shop" class="hidden fade-in">
            <div class="page-header"><h1 style="margin:0; font-size:1.8rem; font-weight:300;">Market</h1><div class="page-title">Buffs</div></div>
            <div id="active-buffs-container" style="margin-bottom:20px;"></div>
            <div class="glass-panel shop-item">
                <div style="display:flex; gap:15px; align-items:center;"><div class="item-icon" style="color:var(--neon-blue);">‚ùÑÔ∏è</div><div><div style="font-weight:700; font-size:1.1rem;">Streak Freeze</div><div style="font-size:0.9rem; color:var(--text-muted);">Seri Koruma</div></div></div>
                <button id="btn-freeze" class="btn price-btn" onclick="window.buyItem('freeze', 200)">200</button>
            </div>
            <div class="glass-panel shop-item">
                <div style="display:flex; gap:15px; align-items:center;"><div class="item-icon" style="color:var(--neon-purple);">‚ö°</div><div><div style="font-weight:700; font-size:1.1rem;">Double XP</div><div style="font-size:0.9rem; color:var(--text-muted);">20x Soru Bonusu</div></div></div>
                <button id="btn-double" class="btn price-btn" onclick="window.buyItem('double', 350)">350</button>
            </div>
        </div>
        <div id="tab-profile" class="hidden fade-in">
            <div style="text-align:center; margin-bottom:30px; margin-top:20px;">
                <div class="progress-ring-container">
                    <svg class="progress-ring-svg">
                        <circle class="progress-ring-circle-bg" r="54" cx="60" cy="60"></circle>
                        <circle class="progress-ring-circle" id="mastery-ring" r="54" cx="60" cy="60"></circle>
                    </svg>
                    <div class="progress-ring-text">
                        <div id="mastery-pct" style="font-size:1.5rem; font-weight:800; color:var(--neon-green);">0%</div>
                        <div style="font-size:0.7rem; color:var(--text-muted); letter-spacing:1px;">MASTERY</div>
                    </div>
                </div>
                <h2 style="margin:0; font-size:1.5rem;">Profilim</h2>
                <div id="career-badge" style="color:var(--neon-blue); font-family:monospace; margin-top:5px; font-size:1.1rem;">Lvl 1 ‚Ä¢ Stajyer</div>
                <div id="user-email" style="font-size:0.8rem; color:var(--text-muted); margin-top:5px; opacity:0;"></div>
            </div>
            <div id="auth-container">
                <button id="google-login-btn" class="google-btn" onclick="window.loginGoogle()">
                    <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.84z"/><path fill="#EA4335" d="M12 4.36c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 1.09 14.97 0 12 0 7.7 0 3.99 2.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    Google ile Giri≈ü Yap
                </button>
                <button id="logout-btn" class="google-btn logout-btn hidden" onclick="window.logoutGoogle()">
                    √áƒ±kƒ±≈ü Yap
                </button>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:30px;">
                <div class="glass-panel" style="padding:20px; text-align:center;">
                    <div id="stat-xp" style="font-size:1.8rem; font-weight:800; color:var(--neon-blue);">0</div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">Toplam XP</div>
                </div>
                <div class="glass-panel" style="padding:20px; text-align:center;">
                    <div id="stat-words" style="font-size:1.8rem; font-weight:800; color:var(--neon-green);">0</div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">√ñƒürenilen (Total)</div>
                </div>
            </div>
            <h3 style="font-weight:300; margin-bottom:15px;">Haftalƒ±k Aktivite</h3>
            <div class="glass-panel" style="padding:15px; margin-bottom:30px;">
                <div id="weekly-chart" class="chart-container"></div>
            </div>
            <h3 style="font-weight:300; border-bottom:1px solid var(--glass-border); padding-bottom:10px; margin-bottom:15px;">Favoriler</h3>
            <div id="favorites-list" style="min-height:50px; margin-bottom:30px;"><div style="color:var(--text-muted); font-size:0.9rem; text-align:center;">Liste bo≈ü.</div></div>
            <button class="btn w-full" style="padding:15px; background:rgba(239,68,68,0.15); color:var(--neon-red); border:1px solid rgba(239,68,68,0.3); border-radius:16px;" onclick="window.resetData()">Verileri Sƒ±fƒ±rla</button>
        </div>
    </main>
    <div class="nav-dock-container">
        <nav class="nav-dock">
            <button class="nav-item active" onclick="window.switchTab('learn', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"></path><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"></path></svg></button>
            <button class="nav-item" onclick="window.switchTab('quests', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg></button>
            <button class="nav-item" onclick="window.switchTab('quiz', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="6" x2="10" y1="12" y2="12"></line><line x1="8" x2="8" y1="10" y2="14"></line><line x1="15" x2="15.01" y1="13" y2="13"></line><line x1="18" x2="18.01" y1="11" y2="11"></line><rect x="2" y="6" width="20" height="12" rx="2"></rect></svg></button>
            <button class="nav-item" onclick="window.switchTab('shop', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path><path d="M3 6h18"></path><path d="M16 10a4 4 0 0 1-8 0"></path></svg></button>
            <button class="nav-item" onclick="window.switchTab('profile', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></button>
        </nav>
    </div>
    <!-- Sequential Script Loading (No Modules) -->
    <script src="js/store.js"></script>
    <script src="js/utils.js"></script>
    <!-- Firebase Compat (Works on file://) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>

    <script>
        const userConfig = {
            apiKey: "AIzaSyDUN827ZeD2YhEYAkB5OeWkF6OIiF59bFI",
            authDomain: "learning-eng-cc8e5.firebaseapp.com",
            projectId: "learning-eng-cc8e5",
            storageBucket: "learning-eng-cc8e5.firebasestorage.app",
            messagingSenderId: "443233964962",
            appId: "1:443233964962:web:d7181e4bb4e2377c5898fb",
            measurementId: "G-K60HHNSBQ2"
        };

        const firebaseConfig = (typeof window.__firebase_config !== 'undefined') ? JSON.parse(window.__firebase_config) : userConfig;

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Expose simplified API for app modules
        window.Firebase = {
            auth: firebase.auth(),
            db: firebase.firestore(),
            analytics: firebase.analytics(),
            googleProvider: new firebase.auth.GoogleAuthProvider(),
            // Map compat methods to match modular names used in profile.js
            signInWithPopup: (auth, provider) => auth.signInWithPopup(provider),
            signOut: (auth) => auth.signOut(),
            onAuthStateChanged: (auth, cb) => auth.onAuthStateChanged(cb),
            signInAnonymously: (auth) => auth.signInAnonymously(),
            doc: (db, ...path) => {
                // Compat firestore doc() takes a path string
                // We need to handle the variadic arguments from the modular style
                // path[0] is db instance (ignored in compat), path[1...] are collection/doc parts
                // Actually, let's just make profile.js use the compat API directly to be cleaner.
                // But to minimize changes, we can try to adapt.
                // Better: Update profile.js to use window.Firebase.db.doc(...) style?
                // No, let's update profile.js to use the compat API. It's safer.
                return null; 
            }
        };
    </script>
    <script src="js/modules/learn.js"></script>
    <script src="js/modules/quests.js"></script>
    <script src="js/modules/shop.js"></script>
    <script src="js/modules/quiz.js"></script>
    <script src="js/modules/profile.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

